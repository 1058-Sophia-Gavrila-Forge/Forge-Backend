parameters:
  - name: 'jobName'
    type: string
  - name: 'branchMain' #Main branch name
    type: string
  - name: 'serviceConnectionMain' #Kubernetes Service Connection name
    type: string
  - name: 'serviceConnectionDev' #Kubernetes Service Connection name
    type: string
  - name: 'manifestPath' #Kubernetes manifest file path
    type: string
  - name: namespace
    type: string
jobs:
  - job: ${{ parameters.jobName }}
    steps:
      - task: KubernetesManifest@0
        condition: ne(variables['Build.SourceBranch'], '${{ parameters.branchMain }}')
        inputs:
          action: 'deploy'
          kubernetesServiceConnection: '${{ parameters.serviceConnectionDev }}'
          namespace: 'team2'
          manifests: '${{ parameters.manifestPath }}'
          rolloutStatusTimeout: '10'
        displayName: Deploy to Dev

      - task: KubernetesManifest@0
        condition: eq(variables['Build.SourceBranch'], '${{ parameters.branchMain }}')
        inputs:
          action: 'deploy'
          kubernetesServiceConnection: '${{ parameters.serviceConnectionMain }}'
          manifests: '${{ parameters.manifestPath }}'
          namespace: 'team2'
          rolloutStatusTimeout: '10'
        displayName: Deploy to Staging
    displayName: Deploy to Cluster
